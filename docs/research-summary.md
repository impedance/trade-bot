# Сводка по анализу `robot.xlsb` (по материалам `research-1.md`)

## Ключевые находки
- VBA-модули в `vbaProject.bin`: `General`, `br_30min_strat3`, `SupportFunctions`, `Orders`, `Log`, `Deals`, а также `s6`, `s7`, `s8`, `s10` (отдельные стратегии/формы).
- Текстовые маркеры логирования: `[NEWDEAL]`, `[CHECK]`, строки вида `"o", Opera`, параметры `SecCode`, `delta`, `slip`, `sl`, `tk`, обращения к `Sheets(...)`.
- Код сжат (MS-OVBA), прямого текста процедур нет; нужен декомпрессор (`olevba`/`vbac`) для извлечения.

## Предполагаемая архитектура
- `General`: инициализация, константы, глобальные переменные, таймеры/циклические вызовы.
- `SupportFunctions`: утилиты (дата/время, поиск по листам, конвертация, расчёты индикаторов).
- `Orders`: формирование и лог заявок (`orders`, файлы/ODBC), комментарии с кодами стратегий (`o-RS7_120-4-18-45` и т.п.).
- `Deals`: разбор листа `deals`, сопоставление заявок/сделок, пересчёт PnL.
- `Log`: сервисный лог (`[CHECK]`, `[NEWDEAL]`), диагностика на лист/Immediate.
- `br_30min_strat3` и `s6/s7/s8/s10`: конкретные стратегии (например, BR 30m; RS7/S7/S8/AR6 и т.д.).

## Листы и данные (по расшифровке)
- `strategies`: конфиг/статус стратегий (`Strategie`, `Sheet`, `SecCode`, `TimeFrame`, `delta(k)`, `sl`, `tp`, `slip`, `Qty`, `Pos`, `BlockTrade`, `Max/Min/Avg`, `Direction`, `EnterPrice`, `TradeResult`, комиссии).
- `quotes`: поток «Текущие торги» из QUIK (оборот, last, bid/ask, heartbeat).
- `gold`, `mxi`, `br`, `si`: OHLC ряды по инструментам (дата `YYYYMMDD`, время `HHMMSS`, open/high/low/close).
- `orders`: лог заявок из QUIK; комментарии в формате `o-<стратегия_параметры>` / `c-...` (open/close), стандартные поля заявки.
- `deals`: лог исполнений; используется для синхронизации позиций и PnL.
- `portfel`: вероятно сводный портфель; в текущем снимке пустой/неиспользуемый.

## Интеграция с QUIK (DDE/ODBC)
- Данные: импорт котировок/сделок через DDE или ODBC в `quotes`, `orders`, `deals`, плюс агрегация в OHLC-листы.
- Заявки: формирование транзакций в файл/ODBC для импорта QUIK; комментарии кодируют стратегию.
- Параметры управления: `delta`, `sl` (stop-loss), `tk` (take-profit), `slip`, `Qty`, `Pos`, `EnterPrice`.

## Ограничения текущего анализа
- Полный исходный VBA не извлечён: требуется декомпрессия потоков `VBA/*` из `vbaProject.bin` (нужны внешние инструменты).
- Данные о сделках/заявках не разобраны по времени — для ревёрса логики потребуется история `orders/deals` и ценовые ряды.

## Следующие шаги (предложение, в рамках анализа)
- Извлечь VBA через `olevba`/`vbac` и сохранить `.bas/.cls/.frm` для детального ревью, если появятся инструменты.
- Если инструменты недоступны — восстановить логику по истории: взять конкретную стратегию из `strategies`, сопоставить сделки `orders/deals` с ценами `gold/mxi/br/si`, реконструировать правила вход/выход.
- Пока фокус на анализе текущего Excel-робота; переписывание на другой стек (Python/QLua/QuikPy) откладывается до завершения анализа.
